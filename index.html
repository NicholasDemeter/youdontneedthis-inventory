<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>You Don't Need This - Premium Tech Boutique</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1b69 50%, #1a1a1a 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Firefly lightning bolts */
        .firefly {
            position: fixed;
            color: #fbbf24;
            font-size: 12px;
            opacity: 0;
            z-index: 1;
            pointer-events: none;
            text-shadow: 0 0 10px #fbbf24;
        }

        .firefly1 { top: 15%; left: 10%; animation: firefly1 4s infinite; }
        .firefly2 { top: 25%; right: 15%; animation: firefly2 3.5s infinite 0.5s; }
        .firefly3 { top: 45%; left: 5%; animation: firefly3 4.2s infinite 1s; }
        .firefly4 { top: 60%; right: 8%; animation: firefly4 3.8s infinite 1.5s; }
        .firefly5 { top: 80%; left: 20%; animation: firefly5 4.5s infinite 2s; }
        .firefly6 { top: 35%; right: 25%; animation: firefly6 3.2s infinite 0.8s; }
        .firefly7 { top: 70%; left: 80%; animation: firefly7 4.1s infinite 2.3s; }
        .firefly8 { top: 20%; left: 70%; animation: firefly8 3.7s infinite 1.2s; }

        @keyframes firefly1 {
            0%, 100% { opacity: 0; transform: translateY(0px) scale(0.8); }
            20% { opacity: 1; transform: translateY(-10px) scale(1.2); }
            40% { opacity: 0.3; transform: translateY(-5px) scale(0.9); }
            60% { opacity: 0.8; transform: translateY(-15px) scale(1.1); }
            80% { opacity: 0.2; transform: translateY(-8px) scale(0.7); }
        }

        @keyframes firefly2 {
            0%, 100% { opacity: 0; transform: translateX(0px) scale(0.7); }
            25% { opacity: 0.9; transform: translateX(-8px) scale(1.3); }
            50% { opacity: 0.4; transform: translateX(-12px) scale(0.8); }
            75% { opacity: 0.7; transform: translateX(-5px) scale(1.0); }
        }

        @keyframes firefly3 {
            0%, 100% { opacity: 0; transform: translate(0px, 0px) scale(0.9); }
            30% { opacity: 0.8; transform: translate(8px, -12px) scale(1.1); }
            60% { opacity: 0.3; transform: translate(12px, -8px) scale(0.6); }
            90% { opacity: 0.6; transform: translate(4px, -15px) scale(1.0); }
        }

        @keyframes firefly4 {
            0%, 100% { opacity: 0; transform: rotate(0deg) scale(0.8); }
            20% { opacity: 0.7; transform: rotate(10deg) scale(1.2); }
            40% { opacity: 0.2; transform: rotate(-5deg) scale(0.9); }
            60% { opacity: 0.9; transform: rotate(15deg) scale(1.0); }
            80% { opacity: 0.4; transform: rotate(-10deg) scale(0.7); }
        }

        @keyframes firefly5 {
            0%, 100% { opacity: 0; transform: translateY(0px) translateX(0px) scale(0.7); }
            25% { opacity: 0.6; transform: translateY(-8px) translateX(5px) scale(1.1); }
            50% { opacity: 0.9; transform: translateY(-15px) translateX(10px) scale(0.8); }
            75% { opacity: 0.3; transform: translateY(-10px) translateX(3px) scale(1.2); }
        }

        @keyframes firefly6 {
            0%, 100% { opacity: 0; transform: scale(0.6); }
            15% { opacity: 0.8; transform: scale(1.3); }
            35% { opacity: 0.2; transform: scale(0.8); }
            55% { opacity: 0.9; transform: scale(1.0); }
            75% { opacity: 0.4; transform: scale(0.7); }
            90% { opacity: 0.7; transform: scale(1.1); }
        }

        @keyframes firefly7 {
            0%, 100% { opacity: 0; transform: translateX(0px) translateY(0px) scale(0.8); }
            20% { opacity: 0.7; transform: translateX(-6px) translateY(-10px) scale(1.2); }
            45% { opacity: 0.3; transform: translateX(-10px) translateY(-5px) scale(0.9); }
            70% { opacity: 0.8; transform: translateX(-3px) translateY(-12px) scale(1.0); }
        }

        @keyframes firefly8 {
            0%, 100% { opacity: 0; transform: rotate(0deg) translateY(0px) scale(0.9); }
            30% { opacity: 0.6; transform: rotate(-8deg) translateY(-8px) scale(1.1); }
            60% { opacity: 0.9; transform: rotate(12deg) translateY(-14px) scale(0.7); }
            85% { opacity: 0.4; transform: rotate(-5deg) translateY(-6px) scale(1.3); }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .neon-glow {
            box-shadow: 0 0 20px rgba(147, 51, 234, 0.5);
            border: 1px solid rgba(147, 51, 234, 0.3);
        }
        
        .premium-badge {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .category-tag {
            background: rgba(147, 51, 234, 0.3);
            border: 1px solid rgba(147, 51, 234, 0.5);
        }
        
        .star-rating {
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .header-glow {
            text-shadow: 0 0 30px rgba(147, 51, 234, 0.8);
        }
        
        .loading-spinner {
            border: 4px solid rgba(147, 51, 234, 0.3);
            border-left: 4px solid #9333ea;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stats-card {
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.2) 0%, rgba(79, 70, 229, 0.2) 100%);
            border: 1px solid rgba(147, 51, 234, 0.3);
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="text-white">
    <!-- Floating firefly lightning bolts -->
    <div class="firefly firefly1"><i class="fas fa-bolt"></i></div>
    <div class="firefly firefly2"><i class="fas fa-bolt"></i></div>
    <div class="firefly firefly3"><i class="fas fa-bolt"></i></div>
    <div class="firefly firefly4"><i class="fas fa-bolt"></i></div>
    <div class="firefly firefly5"><i class="fas fa-bolt"></i></div>
    <div class="firefly firefly6"><i class="fas fa-bolt"></i></div>
    <div class="firefly firefly7"><i class="fas fa-bolt"></i></div>
    <div class="firefly firefly8"><i class="fas fa-bolt"></i></div>

    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <div class="flex items-center justify-center mb-6">
                <i class="fas fa-bolt text-yellow-400 text-5xl mr-4" style="text-shadow: 0 0 20px #fbbf24, 0 0 40px #fbbf24;"></i>
                <span class="text-sm uppercase tracking-wider text-gray-300">Premium Tech Boutique</span>
            </div>
            
            <h1 class="text-6xl font-bold mb-4 header-glow bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 bg-clip-text text-transparent">
                You Don't Need This
            </h1>
            
            <p class="text-xl text-gray-300 mb-6">
                Cutting-edge gadgets, premium computers, and exclusive tech items.
                <span class="text-yellow-400 font-bold">GET SMART, BUY NOW</span>
            </p>
            
            <!-- Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto mb-8">
                <div class="stats-card rounded-lg p-4">
                    <div class="text-3xl font-bold text-white" id="totalItems">98</div>
                    <div class="text-sm text-gray-300">Premium Items</div>
                </div>
                <div class="stats-card rounded-lg p-4">
                    <div class="text-3xl font-bold text-yellow-400" id="fiveStarItems">20</div>
                    <div class="text-sm text-gray-300">5-Star Rated</div>
                </div>
                <div class="stats-card rounded-lg p-4">
                    <div class="text-3xl font-bold text-green-400">24hrs</div>
                    <div class="text-sm text-gray-300">Delivery Time</div>
                </div>
                <div class="stats-card rounded-lg p-4">
                    <div class="text-3xl font-bold text-blue-400">üá∫üá∏</div>
                    <div class="text-sm text-gray-300">Authentic & Guaranteed</div>
                </div>
            </div>
        </header>

        <!-- Filters -->
        <div class="glass-card rounded-xl p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">
                        <i class="fas fa-search mr-2"></i>Search Items
                    </label>
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Search 98 premium items..."
                        class="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:border-purple-500 focus:outline-none text-white"
                    >
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">
                        <i class="fas fa-tags mr-2"></i>Category
                    </label>
                    <select id="categoryFilter" class="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:border-purple-500 focus:outline-none text-white">
                        <option value="">All Categories</option>
                        <option value="Gadgets">üéØ Gadgets</option>
                        <option value="High-Tech">üíª High-Tech</option>
                        <option value="High-Fidelity">üéµ High-Fidelity</option>
                        <option value="High-Fashion">üëë High-Fashion</option>
                        <option value="High-Power">‚ö° High-Power</option>
                        <option value="High-Life">‚ú® High-Life</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">
                        <i class="fas fa-star mr-2"></i>Rating
                    </label>
                    <select id="ratingFilter" class="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:border-purple-500 focus:outline-none text-white">
                        <option value="">All Ratings</option>
                        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 Stars</option>
                        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê 4+ Stars</option>
                        <option value="3">‚≠ê‚≠ê‚≠ê 3+ Stars</option>
                    </select>
                </div>
            </div>
            
            <div class="mt-4 text-center">
                <span class="text-gray-300">Showing </span>
                <span id="itemCount" class="text-purple-400 font-bold">98</span>
                <span class="text-gray-300"> premium items ‚Ä¢ </span>
                <span class="text-yellow-400">5-star items featured first</span>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="text-center py-16">
            <div class="loading-spinner w-16 h-16 mx-auto rounded-full mb-4"></div>
            <h3 class="text-xl font-semibold text-purple-400 mb-2">Loading premium tech collection...</h3>
            <p class="text-gray-400">Connecting to inventory database</p>
        </div>

        <!-- Items Grid -->
        <div id="itemsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
            <!-- Items will be loaded here -->
        </div>

        <!-- Contact Section -->
        <div class="glass-card rounded-xl p-8 text-center">
            <h2 class="text-3xl font-bold mb-4">
                <i class="fas fa-comments text-purple-400 mr-3"></i>
                Interested in Any Items?
            </h2>
            <p class="text-xl text-gray-300 mb-6">
                Contact our sales team for prices, availability, and fast delivery
            </p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto">
                <a href="https://wa.me/256700000000?text=Hi! I'm interested in your premium tech collection" 
                   class="bg-green-600 hover:bg-green-700 px-8 py-4 rounded-lg font-semibold transition-colors duration-200 flex items-center justify-center">
                    <i class="fab fa-whatsapp text-2xl mr-3"></i>
                    WhatsApp Sales Team
                </a>
                <a href="mailto:sales@youdontneedthis.us" class="bg-blue-600 hover:bg-blue-700 px-8 py-4 rounded-lg font-semibold transition-colors duration-200 flex items-center justify-center">
                    <i class="fas fa-envelope text-2xl mr-3"></i>
                    Email Inquiries
                </a>
            </div>
            
            <div class="grid grid-cols-3 gap-4 max-w-lg mx-auto mt-8 text-sm text-gray-400">
                <div>
                    <i class="fas fa-user-tie text-purple-400 mb-2 block"></i>
                    Team Will Reach Out
                </div>
                <div>
                    <i class="fas fa-shipping-fast text-green-400 mb-2 block"></i>
                    24hr Delivery
                </div>
                <div>
                    <i class="fas fa-certificate text-yellow-400 mb-2 block"></i>
                    Authenticity Guaranteed
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-16 py-8 text-center text-gray-400 border-t border-gray-700">
        <p class="mb-2">¬© 2025 You Don't Need This ‚Ä¢ Premium Tech Boutique ‚Ä¢ Built for instant gratification</p>
        <p class="text-purple-400 font-semibold">youdontneedthis.us ‚Ä¢ GET SMART, BUY NOW</p>
    </footer>

    <script>
        // Configuration
        const GOOGLE_SHEET_ID = '1Pp6bvp4DoDJqVKIrNuN9N6zS_MhVex9UDRSC-nIGI6k';
        const CSV_URL = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/export?format=csv`;
        const AI_DRIVE_BASE = 'https://gensparkstorageprodwest.blob.core.windows.net/web-drive/b2e67a49-8e12-4c43-99b3-60b4ce0b26b4/FOLDER_MASTER_You_Dont_Need_This_WebSite';
        
        let allItems = [];
        let filteredItems = [];

        // Items that need folder name alignment (from the alignment spreadsheet)
        const misalignedItems = [
            'LOT-001', 'LOT-030', 'LOT-046', 'LOT-048', 'LOT-050', 'LOT-052', 
            'LOT-055', 'LOT-056', 'LOT-062', 'LOT-063', 'LOT-064', 'LOT-065', 
            'LOT-088', 'LOT-089', 'LOT-097', 'LOT-098', 'LOT-099', 'LOT-100', 'LOT-101'
        ];

        // Utility Functions
        function sanitizeFolderName(name) {
            return name.replace(/[^a-zA-Z0-9\-_]/g, '_');
        }

        function parseStarRating(rating) {
            if (!rating) return 0;
            const match = rating.match(/(\d+)\s*Stars?/i);
            return match ? parseInt(match[1]) : 0;
        }

        function findActualFolderName(lotNumber, sheetFolderName) {
            // For misaligned items, we need to find the actual folder name
            // This is a simplified approach - in real implementation, you'd fetch the actual folder list
            if (misalignedItems.includes(lotNumber)) {
                // Return a best-guess folder name based on the pattern
                return sanitizeFolderName(sheetFolderName);
            }
            return sanitizeFolderName(sheetFolderName);
        }

        function generateImageUrl(lotNumber, folderName) {
            const actualFolderName = findActualFolderName(lotNumber, folderName);
            // Try multiple image formats: _product.jpg, _thumb.jpg, photo.jpg
            return `${AI_DRIVE_BASE}/${actualFolderName}/Photos/${lotNumber}_product.jpg`;
        }

        function generateThumbUrl(lotNumber, folderName) {
            const actualFolderName = findActualFolderName(lotNumber, folderName);
            return `${AI_DRIVE_BASE}/${actualFolderName}/Photos/${lotNumber}_thumb.jpg`;
        }

        function generatePhotoFallback(lotNumber, folderName) {
            const actualFolderName = findActualFolderName(lotNumber, folderName);
            return `${AI_DRIVE_BASE}/${actualFolderName}/Photos/photo.jpg`;
        }

        function createPlaceholderImage() {
            return `data:image/svg+xml,${encodeURIComponent(`
                <svg xmlns="http://www.w3.org/2000/svg" width="400" height="300" viewBox="0 0 400 300">
                    <defs>
                        <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#374151;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#1f2937;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <rect width="400" height="300" fill="url(#grad)"/>
                    <circle cx="200" cy="120" r="30" fill="#9333ea" opacity="0.3"/>
                    <text x="200" y="160" text-anchor="middle" fill="#e5e7eb" font-family="Arial" font-size="18" font-weight="bold">Premium Tech Item</text>
                    <text x="200" y="180" text-anchor="middle" fill="#9ca3af" font-family="Arial" font-size="14">Loading Image...</text>
                    <rect x="150" y="200" width="100" height="8" fill="#374151" rx="4"/>
                    <rect x="150" y="200" width="60" height="8" fill="#9333ea" rx="4">
                        <animate attributeName="width" values="0;100;0" dur="2s" repeatCount="indefinite"/>
                    </rect>
                </svg>
            `)}`;
        }

        function createStarDisplay(rating) {
            const stars = parseStarRating(rating);
            if (stars === 0) return '';
            
            const starHtml = '‚≠ê'.repeat(stars);
            return `<div class="star-rating text-lg mb-2">${starHtml}</div>`;
        }

        function getCategoryIcon(category) {
            const icons = {
                'Gadgets': 'üéØ',
                'High-Tech': 'üíª',
                'High-Fidelity': 'üéµ',
                'High-Fashion': 'üëë',
                'High-Power': '‚ö°',
                'High-Life': '‚ú®'
            };
            return icons[category] || 'üî•';
        }

        function createPriceVerificationUrl(itemName) {
            const searchTerm = encodeURIComponent(itemName.replace(/LOT-\d+\s*/, ''));
            return `https://www.google.com/search?q=${searchTerm}+price+buy`;
        }

        // Create Item Card
        function createItemCard(item) {
            const stars = parseStarRating(item.COOLNESS_RATING);
            const isPremium = stars >= 5;
            const categoryIcon = getCategoryIcon(item.CATEGORY);
            
            const thumbUrl = generateThumbUrl(item.LOT, item.FOLDER_NAME);
            const imageUrl = generateImageUrl(item.LOT, item.FOLDER_NAME);
            const photoFallback = generatePhotoFallback(item.LOT, item.FOLDER_NAME);
            const placeholder = createPlaceholderImage();
            
            const priceVerifyUrl = createPriceVerificationUrl(item.OFFICIAL_NAME);
            
            return `
                <div class="glass-card rounded-xl overflow-hidden hover-lift ${isPremium ? 'neon-glow' : ''}" data-stars="${stars}">
                    ${isPremium ? '<div class="premium-badge absolute top-4 left-4 z-10 px-3 py-1 rounded-full text-xs font-bold text-black">‚≠ê PREMIUM</div>' : ''}
                    
                    <div class="relative h-64 bg-gray-800 overflow-hidden">
                        <div class="absolute top-4 right-4 z-10">
                            <span class="bg-black/70 px-2 py-1 rounded text-sm font-mono">${item.LOT}</span>
                        </div>
                        <img 
                            src="${placeholder}" 
                            data-primary="${thumbUrl}"
                            data-secondary="${imageUrl}"
                            data-fallback="${photoFallback}"
                            alt="${item.OFFICIAL_NAME}"
                            class="w-full h-full object-cover transition-transform duration-300 hover:scale-110"
                            loading="lazy"
                            onload="this.classList.remove('image-loading')"
                            onerror="handleImageError(this)"
                        >
                    </div>
                    
                    <div class="p-6">
                        ${createStarDisplay(item.COOLNESS_RATING)}
                        
                        <h3 class="text-xl font-bold mb-3 line-clamp-2">${item.OFFICIAL_NAME}</h3>
                        
                        <p class="text-gray-400 text-sm mb-4 line-clamp-3">${item.DESCRIPTION}</p>
                        
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-2xl font-bold text-green-400">${item.PRICE || 'Contact for Price'}</span>
                            ${item.CATEGORY ? `<span class="category-tag px-3 py-1 rounded-full text-xs">${categoryIcon} ${item.CATEGORY}</span>` : ''}
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2">
                            <a href="https://wa.me/256700000000?text=Hi! I'm interested in ${item.LOT}: ${encodeURIComponent(item.OFFICIAL_NAME)}" 
                               class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-center text-sm font-semibold transition-colors duration-200">
                                <i class="fab fa-whatsapp mr-1"></i> Inquire
                            </a>
                            <a href="${priceVerifyUrl}" 
                               target="_blank"
                               class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-center text-sm font-semibold transition-colors duration-200">
                                <i class="fas fa-search mr-1"></i> Verify Price
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        // Image Error Handling
        function handleImageError(img) {
            if (img.src === img.dataset.primary) {
                // Try secondary image
                img.src = img.dataset.secondary;
            } else if (img.src === img.dataset.secondary) {
                // Try fallback photo
                img.src = img.dataset.fallback;
            } else {
                // Use placeholder
                img.src = createPlaceholderImage();
            }
        }

        // Load Images with Smart Fallback
        function loadImagesWithFallback() {
            const images = document.querySelectorAll('img[data-primary]');
            images.forEach(img => {
                img.src = img.dataset.primary;
            });
        }

        // Filter and Search Functions
        function filterItems() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const ratingFilter = document.getElementById('ratingFilter').value;

            filteredItems = allItems.filter(item => {
                const matchesSearch = !searchTerm || 
                    item.OFFICIAL_NAME.toLowerCase().includes(searchTerm) ||
                    item.DESCRIPTION.toLowerCase().includes(searchTerm) ||
                    item.LOT.toLowerCase().includes(searchTerm);

                const matchesCategory = !categoryFilter || item.CATEGORY === categoryFilter;
                
                const itemStars = parseStarRating(item.COOLNESS_RATING);
                const matchesRating = !ratingFilter || itemStars >= parseInt(ratingFilter);

                return matchesSearch && matchesCategory && matchesRating;
            });

            // Sort by stars (5-star first), then alphabetically
            filteredItems.sort((a, b) => {
                const starsA = parseStarRating(a.COOLNESS_RATING);
                const starsB = parseStarRating(b.COOLNESS_RATING);
                
                if (starsA !== starsB) {
                    return starsB - starsA; // Higher stars first
                }
                
                return a.OFFICIAL_NAME.localeCompare(b.OFFICIAL_NAME);
            });

            renderItems();
            updateItemCount();
        }

        function renderItems() {
            const grid = document.getElementById('itemsGrid');
            if (filteredItems.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <i class="fas fa-search text-6xl text-gray-600 mb-4"></i>
                        <h3 class="text-2xl font-bold text-gray-400 mb-2">No items found</h3>
                        <p class="text-gray-500">Try adjusting your search or filters</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredItems.map(createItemCard).join('');
            
            // Load images after rendering
            setTimeout(loadImagesWithFallback, 100);
        }

        function updateItemCount() {
            document.getElementById('itemCount').textContent = filteredItems.length;
        }

        function updateStats() {
            const fiveStarCount = allItems.filter(item => parseStarRating(item.COOLNESS_RATING) >= 5).length;
            document.getElementById('totalItems').textContent = allItems.length;
            document.getElementById('fiveStarItems').textContent = fiveStarCount;
        }

        // FIXED: Load Data with Papa Parse (no more custom CSV parsing)
        async function loadData() {
            try {
                const response = await fetch(CSV_URL);
                const csvText = await response.text();
                
                // Use Papa Parse for proper CSV handling
                const parsed = Papa.parse(csvText, {
                    header: true,
                    dynamicTyping: true,
                    skipEmptyLines: true,
                    delimitersToGuess: [',', '\t', '|', ';']
                });
                
                console.log("Papa Parse found:", parsed.data.length, "total rows");
                
                // Debug filtering
                let validItems = 0;
                let droppedItems = [];
                
                const filteredData = parsed.data.filter(item => {
                    const hasLot = item.LOT && item.LOT.toString().trim();
                    const hasName = item.OFFICIAL_NAME && item.OFFICIAL_NAME.toString().trim();
                    
                    if (hasLot && hasName) {
                        validItems++;
                        return true;
                    } else {
                        droppedItems.push({
                            lot: item.LOT,
                            name: item.OFFICIAL_NAME,
                            reason: !hasLot ? 'missing LOT' : 'missing OFFICIAL_NAME'
                        });
                        return false;
                    }
                });
                
                console.log("Valid items after filtering:", validItems);
                console.log("Dropped items:", droppedItems.length);
                if (droppedItems.length > 0) {
                    console.log("First few dropped items:", droppedItems.slice(0, 5));
                }
                
                allItems = filteredData;
                filteredItems = [...allItems];
                
                // Sort by stars initially (5-star first)
                filteredItems.sort((a, b) => {
                    const starsA = parseStarRating(a.COOLNESS_RATING);
                    const starsB = parseStarRating(b.COOLNESS_RATING);
                    
                    if (starsA !== starsB) {
                        return starsB - starsA;
                    }
                    
                    return a.OFFICIAL_NAME.localeCompare(b.OFFICIAL_NAME);
                });

                document.getElementById('loadingState').style.display = 'none';
                renderItems();
                updateStats();
                updateItemCount();
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loadingState').innerHTML = `
                    <div class="text-center">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-xl text-red-300">Error loading items. Please refresh the page.</p>
                        <p class="text-sm text-gray-400 mt-2">Check Google Sheets connection</p>
                    </div>
                `;
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            document.getElementById('searchInput').addEventListener('input', filterItems);
            document.getElementById('categoryFilter').addEventListener('change', filterItems);
            document.getElementById('ratingFilter').addEventListener('change', filterItems);
        });
    </script>
</body>
</html>